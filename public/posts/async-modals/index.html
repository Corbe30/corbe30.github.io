<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>A Bottom-up Approach to Async Modals in React | Corbe30</title>
<meta name="keywords" content="react">
<meta name="description" content="In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.
Let&rsquo;s try to build it from the ground up:
1. Bare bones

App.js
function App() {
  const [isModalOpen, setIsModalOpen] = useState(false);

  const onResponseClick = (response) =&gt; {
    setIsModalOpen(false);
    console.log(response);
  };

  return (
    &lt;div&gt;
      {isModalOpen &amp;&amp; &lt;Modal onResponseClick={onResponseClick} /&gt;}
      &lt;button
        onClick={() =&gt; {
          setIsModalOpen(true);
        }}
      &gt;
        Open Modal
      &lt;/button&gt;
    &lt;/div&gt;
  );
}

To get the response (yes/no) from the modal, App component is forced to manage isModalOpen state and include &lt;Modal /&gt; component in its JSX. We know there is a better way to manage this by using Context.">
<meta name="author" content="">
<link rel="canonical" href="https://canonical.url/to/page">
<link crossorigin="anonymous" href="/assets/css/stylesheet.efc11bcb5d31e7c91a87866a42f4dede09b7cbf81ea0cd1f9d3c26a637209b49.css" integrity="sha256-78Eby10x58kah4ZqQvTe3gm3y/geoM0fnTwmpjcgm0k=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://corbe30.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://corbe30.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://corbe30.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://corbe30.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://corbe30.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://corbe30.github.io/posts/async-modals/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://corbe30.github.io/posts/async-modals/">
  <meta property="og:site_name" content="Corbe30">
  <meta property="og:title" content="A Bottom-up Approach to Async Modals in React">
  <meta property="og:description" content="In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.
Let‚Äôs try to build it from the ground up:
1. Bare bones App.js function App() { const [isModalOpen, setIsModalOpen] = useState(false); const onResponseClick = (response) =&gt; { setIsModalOpen(false); console.log(response); }; return ( &lt;div&gt; {isModalOpen &amp;&amp; &lt;Modal onResponseClick={onResponseClick} /&gt;} &lt;button onClick={() =&gt; { setIsModalOpen(true); }} &gt; Open Modal &lt;/button&gt; &lt;/div&gt; ); } To get the response (yes/no) from the modal, App component is forced to manage isModalOpen state and include &lt;Modal /&gt; component in its JSX. We know there is a better way to manage this by using Context.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-26T21:40:25+05:30">
    <meta property="article:modified_time" content="2025-02-26T21:40:25+05:30">
    <meta property="article:tag" content="React">
    <meta property="og:image" content="https://raw.githubusercontent.com/Corbe30/corbe30.github.io/refs/heads/main/assets/images/asyncModal_gif.gif">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Corbe30/corbe30.github.io/refs/heads/main/assets/images/asyncModal_gif.gif">
<meta name="twitter:title" content="A Bottom-up Approach to Async Modals in React">
<meta name="twitter:description" content="In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.
Let&rsquo;s try to build it from the ground up:
1. Bare bones

App.js
function App() {
  const [isModalOpen, setIsModalOpen] = useState(false);

  const onResponseClick = (response) =&gt; {
    setIsModalOpen(false);
    console.log(response);
  };

  return (
    &lt;div&gt;
      {isModalOpen &amp;&amp; &lt;Modal onResponseClick={onResponseClick} /&gt;}
      &lt;button
        onClick={() =&gt; {
          setIsModalOpen(true);
        }}
      &gt;
        Open Modal
      &lt;/button&gt;
    &lt;/div&gt;
  );
}

To get the response (yes/no) from the modal, App component is forced to manage isModalOpen state and include &lt;Modal /&gt; component in its JSX. We know there is a better way to manage this by using Context.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://corbe30.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "A Bottom-up Approach to Async Modals in React",
      "item": "https://corbe30.github.io/posts/async-modals/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "A Bottom-up Approach to Async Modals in React",
  "name": "A Bottom-up Approach to Async Modals in React",
  "description": "In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.\nLet\u0026rsquo;s try to build it from the ground up:\n1. Bare bones App.js function App() { const [isModalOpen, setIsModalOpen] = useState(false); const onResponseClick = (response) =\u0026gt; { setIsModalOpen(false); console.log(response); }; return ( \u0026lt;div\u0026gt; {isModalOpen \u0026amp;\u0026amp; \u0026lt;Modal onResponseClick={onResponseClick} /\u0026gt;} \u0026lt;button onClick={() =\u0026gt; { setIsModalOpen(true); }} \u0026gt; Open Modal \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } To get the response (yes/no) from the modal, App component is forced to manage isModalOpen state and include \u0026lt;Modal /\u0026gt; component in its JSX. We know there is a better way to manage this by using Context.\n",
  "keywords": [
    "react"
  ],
  "articleBody": "In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.\nLet‚Äôs try to build it from the ground up:\n1. Bare bones App.js function App() { const [isModalOpen, setIsModalOpen] = useState(false); const onResponseClick = (response) =\u003e { setIsModalOpen(false); console.log(response); }; return ( \u003cdiv\u003e {isModalOpen \u0026\u0026 \u003cModal onResponseClick={onResponseClick} /\u003e} \u003cbutton onClick={() =\u003e { setIsModalOpen(true); }} \u003e Open Modal \u003c/button\u003e \u003c/div\u003e ); } To get the response (yes/no) from the modal, App component is forced to manage isModalOpen state and include component in its JSX. We know there is a better way to manage this by using Context.\n2. Context for consolidation Context can help us manage isModalOpen state and Modal component. But notice that the control for handling response moves to ModalContext.\nApp.js function App() { const modalCtx = useContext(ModalContext); return ( \u003cdiv\u003e \u003cbutton onClick={() =\u003e {modalCtx.setIsModalOpen(true)}}\u003e Open Modal \u003c/button\u003e \u003c/div\u003e ); } ModalContext.js export const ModalContext = createContext(); export const ModalProvider = ({ children }) =\u003e { const [isModalOpen, setIsModalOpen] = useState(false); const onResponseClick = (response) =\u003e { setIsModalOpen(false); console.log(response); }; return ( \u003cModalContext.Provider value={{ setIsModalOpen }}\u003e {isModalOpen \u0026\u0026 \u003cModal onResponseClick={onResponseClick} /\u003e} {children} \u003c/ModalContext.Provider\u003e ); }; To solve this, ModalContext can maintain another state response which will be observed by an useEffect in App component. Even so, the new response might be same as the previous, so we will need a responseKey which will be unique for every response.\nThis seems like a hassle:\nwe don‚Äôt want App to deal with context but want App to have control over response A custom hook will help us do both.\n3. Introducing useAsyncModal We create useAsyncModal hook, which will lie between ModalContext and App. It will manage context, and provide App component with a method to get response. useAsyncModal creates a promise, which is only resolved when the user clicks on either of the modal buttons.\nApp.js function App() { const { confirm } = useModal(); const onClickHandler = async () =\u003e { const response = await confirm(); console.log(response); }; return ( \u003cdiv\u003e \u003cbutton onClick={onClickHandler}\u003eOpen Modal\u003c/button\u003e \u003c/div\u003e ); } useAsyncModal.js const useAsyncModal = () =\u003e { const modalCtx = useContext(ModalContext); const confirm = async () =\u003e { modalCtx.setIsModalOpen(true); const response = await modalCtx.forUserToConfirm(); return response; }; return { confirm }; }; ModalContext.js export const ModalContext = createContext(); export const ModalProvider = ({ children }) =\u003e { const [settlePromise, setSettlePromise] = useState({}); const [isModalOpen, setIsModalOpen] = useState(false); const onResponseClick = (val) =\u003e { setIsModalOpen(false); settlePromise.resolve(val); }; const forUserToConfirm = () =\u003e { const confirmPromise = new Promise((resolve, reject) =\u003e { setSettlePromise({ resolve, reject }); }); return confirmPromise; }; return ( \u003cModalContext.Provider value={{ setIsModalOpen, forUserToConfirm }}\u003e {isModalOpen \u0026\u0026 \u003cModal onResponseClick={onResponseClick} /\u003e} {children} \u003c/ModalContext.Provider\u003e ); }; This Modal can now be used by any component, all while improving the code readability! You can view the code at my Github repo. It contains 3 branches, one for each step of this article.\n",
  "wordCount" : "503",
  "inLanguage": "en",
  "image":"https://raw.githubusercontent.com/Corbe30/corbe30.github.io/refs/heads/main/assets/images/asyncModal_gif.gif","datePublished": "2025-02-26T21:40:25+05:30",
  "dateModified": "2025-02-26T21:40:25+05:30",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://corbe30.github.io/posts/async-modals/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Corbe30",
    "logo": {
      "@type": "ImageObject",
      "url": "https://corbe30.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://corbe30.github.io/" accesskey="h" title="Corbe30 (Alt + H)">Corbe30</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://corbe30.github.io/resume/" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="https://corbe30.github.io/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://corbe30.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://corbe30.github.io/search/" title="üîçÔ∏é">
                    <span>üîçÔ∏é</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://corbe30.github.io/">Home</a>&nbsp;¬ª&nbsp;<a href="https://corbe30.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      A Bottom-up Approach to Async Modals in React
    </h1>
    <div class="post-meta"><span title='2025-02-26 21:40:25 +0530 IST'>February 26, 2025</span>&nbsp;¬∑&nbsp;3 min

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="https://raw.githubusercontent.com/Corbe30/corbe30.github.io/refs/heads/main/assets/images/asyncModal_gif.gif" alt="">
        <p><text></p>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-bare-bones">1. Bare bones</a></li>
    <li><a href="#2-context-for-consolidation">2. <code>Context</code> for consolidation</a></li>
    <li><a href="#3-introducing-useasyncmodal">3. Introducing <code>useAsyncModal</code></a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>In React, you can use combination of Context and custom hooks to implement async modals. Async modals let you capture the response from modal asynchronously, saving the hassle of managing another state and improves readibility.</p>
<p>Let&rsquo;s try to build it from the ground up:</p>
<h2 id="1-bare-bones">1. Bare bones<a hidden class="anchor" aria-hidden="true" href="#1-bare-bones">#</a></h2>
<details open>
<summary>App.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">isModalOpen</span><span class="p">,</span> <span class="nx">setIsModalOpen</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onResponseClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">isModalOpen</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">Modal</span> <span class="na">onResponseClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onResponseClick</span><span class="p">}</span> <span class="p">/&gt;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">button</span>
</span></span><span class="line"><span class="cl">        <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Open</span> <span class="nx">Modal</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p>To get the response (yes/no) from the modal, App component is forced to manage <code>isModalOpen</code> state and include <code>&lt;Modal /&gt;</code> component in its JSX. We know there is a better way to manage this by using Context.</p>
<h2 id="2-context-for-consolidation">2. <code>Context</code> for consolidation<a hidden class="anchor" aria-hidden="true" href="#2-context-for-consolidation">#</a></h2>
<p>Context can help us manage <code>isModalOpen</code> state and <code>Modal</code> component. But notice that the control for handling response moves to ModalContext.</p>
<details open>
<summary>App.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">modalCtx</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ModalContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">modalCtx</span><span class="p">.</span><span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">true</span><span class="p">)}}&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Open</span> <span class="nx">Modal</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<details open>
<summary>ModalContext.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">ModalContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">ModalProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">isModalOpen</span><span class="p">,</span> <span class="nx">setIsModalOpen</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onResponseClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ModalContext.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span> <span class="nx">setIsModalOpen</span> <span class="p">}}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">isModalOpen</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">Modal</span> <span class="na">onResponseClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onResponseClick</span><span class="p">}</span> <span class="p">/&gt;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ModalContext.Provider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div></details>
<p>To solve this, ModalContext can maintain another state <code>response</code> which will be observed by an <code>useEffect</code> in App component. Even so, the new <code>response</code> might be <a href="https://stackoverflow.com/a/52625068">same as the previous</a>, so we will need a <code>responseKey</code> which will be unique for every response.</p>
<p>This seems like a hassle:</p>
<ol>
<li>we don&rsquo;t want App to deal with context</li>
<li>but want App to have control over response</li>
</ol>
<p>A <strong>custom hook</strong> will help us do both.</p>
<h2 id="3-introducing-useasyncmodal">3. Introducing <code>useAsyncModal</code><a hidden class="anchor" aria-hidden="true" href="#3-introducing-useasyncmodal">#</a></h2>
<img src="https://raw.githubusercontent.com/Corbe30/corbe30.github.io/refs/heads/main/assets/images/asyncModal_flow.png" />
<p>We create <code>useAsyncModal</code> hook, which will lie between ModalContext and App. It will manage context, and provide App component with a method to get response. <code>useAsyncModal</code> creates a promise, which is only resolved when the user clicks on either of the modal buttons.</p>
<details open>
<summary>App.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">confirm</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onClickHandler</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">confirm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickHandler</span><span class="p">}&gt;</span><span class="nx">Open</span> <span class="nx">Modal</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<details open>
<summary>useAsyncModal.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">useAsyncModal</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">modalCtx</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ModalContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">confirm</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">modalCtx</span><span class="p">.</span><span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">modalCtx</span><span class="p">.</span><span class="nx">forUserToConfirm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">confirm</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div></details>
<details open>
<summary>ModalContext.js</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">ModalContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">ModalProvider</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">settlePromise</span><span class="p">,</span> <span class="nx">setSettlePromise</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({});</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">isModalOpen</span><span class="p">,</span> <span class="nx">setIsModalOpen</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onResponseClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setIsModalOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">settlePromise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">forUserToConfirm</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">confirmPromise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setSettlePromise</span><span class="p">({</span> <span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">confirmPromise</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ModalContext.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span> <span class="nx">setIsModalOpen</span><span class="p">,</span> <span class="nx">forUserToConfirm</span> <span class="p">}}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">isModalOpen</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">Modal</span> <span class="na">onResponseClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onResponseClick</span><span class="p">}</span> <span class="p">/&gt;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ModalContext.Provider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div></details>
<p>This Modal can now be used by any component, all while improving the code readability! You can view the code at my <a href="https://github.com/Corbe30/async-modals">Github repo</a>. It contains 3 branches, one for each step of this article.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://corbe30.github.io/tags/react/">React</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://corbe30.github.io/">Corbe30</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
